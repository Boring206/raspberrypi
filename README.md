# Raspberry Pi 多功能遊戲機安裝指南

## 系統概述

這是一個基於 Raspberry Pi 3 的多功能遊戲機，具有以下特點：
- 內建 9 個不同的小遊戲
- 通過 XBOX 遊戲手柄控制遊戲
- SPI 小螢幕顯示遊戲選單和操作說明
- 4x4 矩陣鍵盤用於遊戲選擇
- 蜂鳴器提供遊戲音效回饋
- HDMI 大螢幕顯示主要遊戲畫面

## 內建遊戲詳細說明

### 1. 貪吃蛇 (Snake)
- **遊戲目標**：控制蛇不斷吃食物成長，同時避免撞到自己。
- **控制方式**：
  - 搖桿控制蛇的移動方向（上下左右）
  - 按 A 鈕：暫時加速
  - 按 Start 鈕：暫停/繼續遊戲
- **計分方式**：每吃一個食物得 1 分
- **遊戲特色**：每得 5 分蛇的移動速度會自動增加，增加遊戲難度。

### 2. 打磚塊 (Brick Breaker)
- **遊戲目標**：移動擋板反彈球，擊碎所有磚塊。
- **控制方式**：
  - 搖桿左右移動擋板
  - 按 A 鈕：發射球（開始遊戲時）
  - 按 Start 鈕：暫停/繼續遊戲
- **計分方式**：擊中不同顏色磚塊獲得不同分數
- **遊戲特色**：不同顏色磚塊需擊中不同次數才會消除，遊戲進行過程中球速會逐漸增加。

### 3. 太空侵略者 (Space Invaders)
- **遊戲目標**：控制太空船射擊外星入侵者，避免被擊中或讓外星人到達底部。
- **控制方式**：
  - 搖桿左右移動太空船
  - 按 A 鈕：發射子彈
  - 按 Start 鈕：暫停/繼續遊戲
- **計分方式**：擊中不同位置外星人獲得不同分數（10-30分）
- **遊戲特色**：外星人隨遊戲進行會加速移動，使遊戲難度增加。

### 4. 井字遊戲 (Tic-Tac-Toe)
- **遊戲目標**：在 3x3 格子中先連成一條線（橫、直、斜）獲勝。
- **控制方式**：
  - 搖桿控制選擇格子
  - 按 A 鈕：在選擇的格子放置棋子
  - 按 Start 鈕：重新開始遊戲
- **計分方式**：成功連線獲勝
- **遊戲特色**：對戰電腦AI，具有基本防守和進攻策略。

### 5. 記憶翻牌 (Memory Match)
- **遊戲目標**：翻開配對的卡片，找出所有對子。
- **控制方式**：
  - 搖桿控制選擇卡片
  - 按 A 鈕：翻開卡片
  - 按 Start 鈕：暫停/繼續遊戲
- **計分方式**：根據完成時間和翻牌次數計算
- **遊戲特色**：不同難度級別（4x4、6x6 格子），配對成功時有動畫和音效提示。

### 6. 簡易迷宮 (Simple Maze)
- **遊戲目標**：在隨機生成的迷宮中找到出口。
- **控制方式**：
  - 搖桿控制角色移動方向
  - 按 A 鈕：顯示提示（短暫顯示正確路徑）
  - 按 Start 鈕：暫停/繼續遊戲
- **計分方式**：根據完成時間和使用提示次數計算
- **遊戲特色**：採用深度優先算法隨機生成迷宮，每次遊戲都有不同迷宮。難度會隨著關卡提升，迷宮尺寸增加。

### 7. 打地鼠 (Whac-A-Mole)
- **遊戲目標**：在地鼠出現時及時敲擊，獲取高分。
- **控制方式**：
  - 搖桿移動槌子
  - 按 A 鈕：敲擊地鼠
  - 按 Start 鈕：暫停/繼續遊戲
- **計分方式**：成功敲中地鼠 +10 分，失敗 -5 分
- **遊戲特色**：地鼠出現速度會隨著時間逐漸加快，增加遊戲挑戰性。遊戲時間 60 秒，以最終得分評定成績。

### 8. 俄羅斯方塊 (Tetris-like)
- **遊戲目標**：控制下落的方塊，排列完整行以得分並延長遊戲時間。
- **控制方式**：
  - 搖桿左右：移動方塊
  - 搖桿向上：旋轉方塊
  - 搖桿向下：加速下落
  - 按 A 鈕：方塊快速直接落底
  - 按 Start 鈕：暫停/繼續遊戲
- **計分方式**：一次消除一行 100 分，多行同時消除有額外獎勵
- **遊戲特色**：經典 7 種形狀方塊，隨關卡提升下落速度增加，顯示下一個方塊提示。

### 9. 反應力測試 (Reaction Test)
- **遊戲目標**：在信號出現後立即按下按鈕，測試反應速度。
- **控制方式**：
  - 按 A 鈕：當綠色信號出現時按下
  - 按 Start 鈕：開始新一輪測試
- **計分方式**：根據反應時間（毫秒）評定反應能力
- **遊戲特色**：
  - 隨機等待時間，防止預判
  - 提供平均反應時間統計
  - 反應結果評級（極快/快/一般/慢）
  - 連續五次測試後顯示總體成績

## 硬體需求

### 基本組件
- Raspberry Pi 3 Model B 或更高版本
- Micro SD 卡 (至少 8GB)
- 電源供應器 (5V 2.5A)
- HDMI 顯示器和 HDMI 線

### 特殊組件
- SPI OLED/LCD 小螢幕 (推薦 SSD1306 或類似型號)
- XBOX 控制器 (USB 連接)
- 4x4 矩陣鍵盤
- 蜂鳴器模組
- 麵包板和連接線

## 接線說明

### SPI 小螢幕接線
| Raspberry Pi 腳位 | SPI 螢幕腳位 |
|-----------------|------------|
| 3.3V (Pin 1)    | VCC        |
| GND (Pin 6)     | GND        |
| GPIO 10 (MOSI)  | DATA       |
| GPIO 11 (SCLK)  | CLK        |
| GPIO 8 (CE0)    | CS         |
| GPIO 24         | DC         |
| GPIO 25         | RST        |

### 矩陣鍵盤接線
| Raspberry Pi 腳位 | 鍵盤腳位 |
|-----------------|---------|
| GPIO 6          | ROW 1   |
| GPIO 13         | ROW 2   |
| GPIO 19         | ROW 3   |
| GPIO 26         | ROW 4   |
| GPIO 12         | COL 1   |
| GPIO 16         | COL 2   |
| GPIO 20         | COL 3   |
| GPIO 21         | COL 4   |

### 蜂鳴器接線
| Raspberry Pi 腳位 | 蜂鳴器腳位 |
|-----------------|---------|
| GPIO 18         | 正極 (+) |
| GND             | 負極 (-) |

## 軟體安裝

### 準備系統
1. 使用 Raspberry Pi Imager 安裝最新的 Raspberry Pi OS (建議使用具有桌面環境的版本)
2. 完成系統初始設定 (語言、時區、網絡等)
3. 啟用 SPI 介面：
   ```
   sudo raspi-config
   # 選擇 Interface Options > SPI > Yes
   ```

### 安裝必要的套件
```bash
# 更新系統
sudo apt update
sudo apt upgrade -y

# 安裝 Python 套件
sudo apt install -y python3-pip python3-dev python3-pygame

# 安裝 GPIO 和 SPI 相關套件
sudo pip3 install RPi.GPIO
sudo pip3 install luma.core luma.oled

# 安裝其他依賴
sudo pip3 install evdev
```

### 下載遊戲程式
```bash
# 創建遊戲目錄
mkdir -p ~/gamebox

# 複製遊戲檔案到此目錄
# [將 gamebox 目錄中的所有檔案複製到 Raspberry Pi]
```

## 運行遊戲
```bash
cd ~/gamebox
sudo python3 main.py
```

## 疑難排解

### SPI 螢幕問題
- 確保 SPI 接口已啟用
- 檢查接線是否正確
- 若螢幕無顯示，可嘗試修改 screen_menu.py 中的設備類型
- 執行以下命令確認 SPI 啟用狀態：
  ```bash
  lsmod | grep spi
  ```

### 控制器問題
- 執行 `lsusb` 確認控制器已連接
- 測試控制器：`python3 gamepad_input.py`
- 若無法識別，重新插拔控制器或嘗試不同 USB 接口
- 檢查控制器是否需要驅動：
  ```bash
  sudo apt install xboxdrv
  ```

### 鍵盤問題
- 檢查接線
- 執行 `python3 matrix_keypad.py` 測試
- 檢查各針腳是否正確連接，可使用萬用表測試連通性

### 遊戲效能問題
- 調整 main.py 中的 FPS 設定（降低以提高效能）
- 檢查 Raspberry Pi 溫度，避免過熱降頻：
  ```bash
  vcgencmd measure_temp
  ```
- 考慮為 Raspberry Pi 增加散熱裝置

## 硬體連接參考圖

```
+---------------------+
|  Raspberry Pi 3     |
|                     |
|  +-------------+    |    +------------------+
|  | GPIO Header |----|--->| 矩陣鍵盤 (4x4)    |
|  +-------------+    |    +------------------+
|                     |
|                     |    +------------------+
|  +-------------+    |    | SPI 小螢幕        |
|  | SPI         |----|--->| (SSD1306)        |
|  +-------------+    |    +------------------+
|                     |
|                     |    +------------------+
|  +-------------+    |    | 蜂鳴器            |
|  | GPIO 18     |----|--->| (PWM控制)         |
|  +-------------+    |    +------------------+
|                     |
|  +-------------+    |    +------------------+
|  | USB Port    |----|--->| Xbox 控制器       |
|  +-------------+    |    +------------------+
|                     |
|  +-------------+    |    +------------------+
|  | HDMI Port   |----|--->| 大螢幕 (顯示器)    |
|  +-------------+    |    +------------------+
+---------------------+
```

## 自定義遊戲

要添加新的遊戲，請遵循以下步驟：

1. 在 `games` 資料夾中建立新的遊戲檔案 (例如 `game10.py`)
2. 實現遊戲類，參考現有遊戲的結構：
   ```python
   class YourNewGame:
       def __init__(self, width=800, height=600, buzzer=None):
           # 初始化遊戲
           
       def reset_game(self):
           # 重置遊戲狀態
           
       def update(self, controller_input=None):
           # 更新遊戲邏輯
           return {"game_over": False, "score": 0}
           
       def render(self, screen):
           # 渲染遊戲畫面
           
       def cleanup(self):
           # 清理資源
   ```
3. 在 `main.py` 中的 `self.games` 列表中添加新遊戲：
   ```python
   from games.game10 import YourNewGame
   
   # 在 GameConsole.__init__ 方法中：
   self.games.append(
       {"id": 10, "name": "你的遊戲", "description": "遊戲描述", "game_class": YourNewGame}
   )
   ```

## 遊戲開發技巧

### 共通模式
所有遊戲遵循相同的基本結構，包含以下方法：
- `__init__`: 初始化遊戲和資源
- `reset_game`: 重置遊戲狀態
- `update`: 處理輸入和更新遊戲邏輯
- `render`: 渲染遊戲畫面
- `cleanup`: 釋放遊戲資源

### 音效使用
通過傳入的 buzzer 對象播放音效：
```python
# 得分音效
self.buzzer.play_tone("score")

# 遊戲結束音效
self.buzzer.play_game_over_melody()

# 遊戲升級音效
self.buzzer.play_tone("level_up")
```

### 常見遊戲元素
- 碰撞檢測
- 分數系統
- 關卡/難度系統
- 暫停/繼續功能
- 動畫效果

## 許可證

本項目為開源項目，依據 MIT 許可證發佈。

## 未來擴充

- 添加更多遊戲
- 支援多人遊戲模式
- 添加高分記錄功能
- 支援網絡遊戲功能
- 添加配置界面，調整畫面大小和控制靈敏度
- 支援更多控制器類型
- 實現無線控制選項
#   r a s p b e r r y p i  
 