# Raspberry Pi 多功能遊戲機安裝指南

## 系統概述

這是一個基於 Raspberry Pi 3 的多功能遊戲機，具有以下特點：
- 內建 9 個不同的小遊戲
- 通過 XBOX 遊戲手柄控制遊戲
- SPI 小螢幕顯示遊戲選單和操作說明
- 4x4 矩陣鍵盤用於遊戲選擇
- 蜂鳴器提供遊戲音效回饋
- HDMI 大螢幕顯示主要遊戲畫面

## 內建遊戲詳細說明

### 1. 貪吃蛇 (Snake)
- **遊戲目標**：控制蛇不斷吃食物成長，同時避免撞到自己。
- **控制方式**：
  - 搖桿控制蛇的移動方向（上下左右）
  - 按 A 鈕：暫時加速
  - 按 Start 鈕：暫停/繼續遊戲
- **計分方式**：每吃一個食物得 1 分
- **遊戲特色**：每得 5 分蛇的移動速度會自動增加，增加遊戲難度。

### 2. 打磚塊 (Brick Breaker)
- **遊戲目標**：移動擋板反彈球，擊碎所有磚塊。
- **控制方式**：
  - 搖桿左右移動擋板
  - 按 A 鈕：發射球（開始遊戲時）
  - 按 Start 鈕：暫停/繼續遊戲
- **計分方式**：擊中不同顏色磚塊獲得不同分數
- **遊戲特色**：不同顏色磚塊需擊中不同次數才會消除，遊戲進行過程中球速會逐漸增加。

### 3. 太空侵略者 (Space Invaders)
- **遊戲目標**：控制太空船射擊外星入侵者，避免被擊中或讓外星人到達底部。
- **控制方式**：
  - 搖桿左右移動太空船
  - 按 A 鈕：發射子彈
  - 按 Start 鈕：暫停/繼續遊戲
- **計分方式**：擊中不同位置外星人獲得不同分數（10-30分）
- **遊戲特色**：外星人隨遊戲進行會加速移動，使遊戲難度增加。

### 4. 井字遊戲 (Tic-Tac-Toe)
- **遊戲目標**：在 3x3 格子中先連成一條線（橫、直、斜）獲勝。
- **控制方式**：
  - 搖桿控制選擇格子
  - 按 A 鈕：在選擇的格子放置棋子
  - 按 Start 鈕：重新開始遊戲
- **計分方式**：成功連線獲勝
- **遊戲特色**：對戰電腦AI，具有基本防守和進攻策略。

### 5. 記憶翻牌 (Memory Match)
- **遊戲目標**：翻開配對的卡片，找出所有對子。
- **控制方式**：
  - 搖桿控制選擇卡片
  - 按 A 鈕：翻開卡片
  - 按 Start 鈕：暫停/繼續遊戲
- **計分方式**：根據完成時間和翻牌次數計算
- **遊戲特色**：不同難度級別（4x4、6x6 格子），配對成功時有動畫和音效提示。

### 6. 簡易迷宮 (Simple Maze)
- **遊戲目標**：在隨機生成的迷宮中找到出口。
- **控制方式**：
  - 搖桿控制角色移動方向
  - 按 A 鈕：顯示提示（短暫顯示正確路徑）
  - 按 Start 鈕：暫停/繼續遊戲
- **計分方式**：根據完成時間和使用提示次數計算
- **遊戲特色**：採用深度優先算法隨機生成迷宮，每次遊戲都有不同迷宮。難度會隨著關卡提升，迷宮尺寸增加。

### 7. 打地鼠 (Whac-A-Mole)
- **遊戲目標**：在地鼠出現時及時敲擊，獲取高分。
- **控制方式**：
  - 搖桿移動槌子
  - 按 A 鈕：敲擊地鼠
  - 按 Start 鈕：暫停/繼續遊戲
- **計分方式**：成功敲中地鼠 +10 分，失敗 -5 分
- **遊戲特色**：地鼠出現速度會隨著時間逐漸加快，增加遊戲挑戰性。遊戲時間 60 秒，以最終得分評定成績。

### 8. 俄羅斯方塊 (Tetris-like)
- **遊戲目標**：控制下落的方塊，排列完整行以得分並延長遊戲時間。
- **控制方式**：
  - 搖桿左右：移動方塊
  - 搖桿向上：旋轉方塊
  - 搖桿向下：加速下落
  - 按 A 鈕：方塊快速直接落底
  - 按 Start 鈕：暫停/繼續遊戲
- **計分方式**：一次消除一行 100 分，多行同時消除有額外獎勵
- **遊戲特色**：經典 7 種形狀方塊，隨關卡提升下落速度增加，顯示下一個方塊提示。

### 9. 反應力測試 (Reaction Test)
- **遊戲目標**：在信號出現後立即按下按鈕，測試反應速度。
- **控制方式**：
  - 按 A 鈕：當綠色信號出現時按下
  - 按 Start 鈕：開始新一輪測試
- **計分方式**：根據反應時間（毫秒）評定反應能力
- **遊戲特色**：
  - 隨機等待時間，防止預判
  - 提供平均反應時間統計
  - 反應結果評級（極快/快/一般/慢）
  - 連續五次測試後顯示總體成績

## 硬體需求

### 基本組件
- Raspberry Pi 3 Model B 或更高版本
- Micro SD 卡 (至少 8GB)
- 電源供應器 (5V 2.5A)
- HDMI 顯示器和 HDMI 線

### 特殊組件
- SPI OLED/LCD 小螢幕 (推薦 SSD1306 或類似型號)
- XBOX 控制器 (USB 連接)
- 4x4 矩陣鍵盤
- 蜂鳴器模組 (GPIO PWM 控制)
- 麵包板和連接線 (杜邦線)

## 接線說明

**重要**：在進行任何接線之前，請確保您的 Raspberry Pi 已經關機並拔除電源！

**腳位衝突檢查**： 以下所有 GPIO 腳位分配已經過檢查，確保沒有重複使用。

### SPI 小螢幕接線

| Raspberry Pi 腳位 (BCM 編號) | SPI 螢幕腳位 | 備註 |
|---------------------------|------------|------|
| 3.3V (實體 Pin 1 或 Pin 17) | VCC | 電源正極 |
| GND (實體 Pin 6, 9, 14, 等) | GND | 電源負極 (接地) |
| GPIO 10 (實體 Pin 19, MOSI) | DATA / MOSI | SPI Master Out Slave In (數據輸出到螢幕) |
| GPIO 11 (實體 Pin 23, SCLK) | CLK / SCLK | SPI Serial Clock (時脈) |
| GPIO 8 (實體 Pin 24, CE0) | CS / CE0 | SPI Chip Select (片選) |
| GPIO 24 (實體 Pin 18) | DC | Data/Command (數據/命令選擇) |
| GPIO 25 (實體 Pin 22) | RST / RESET | Reset (重置) |

**註**：請再次確認您的 SPI 螢幕模組上的腳位名稱，VCC 通常接 Raspberry Pi 的 3.3V。

### 矩陣鍵盤接線

| Raspberry Pi 腳位 (BCM 編號) | 鍵盤腳位 | 備註 |
|---------------------------|---------|------|
| GPIO 6  (實體 Pin 31) | ROW 1 | 行 1 |
| GPIO 13 (實體 Pin 33) | ROW 2 | 行 2 |
| GPIO 19 (實體 Pin 35) | ROW 3 | 行 3 |
| GPIO 26 (實體 Pin 37) | ROW 4 | 行 4 |
| GPIO 12 (實體 Pin 32) | COL 1 | 列 1 |
| GPIO 16 (實體 Pin 36) | COL 2 | 列 2 |
| GPIO 20 (實體 Pin 38) | COL 3 | 列 3 |
| GPIO 21 (實體 Pin 40) | COL 4 | 列 4 |

**註**：矩陣鍵盤的接線順序很重要，請確保行列對應正確。

### 蜂鳴器接線

| Raspberry Pi 腳位 (BCM 編號) | 蜂鳴器腳位 | 備註 |
|---------------------------|-----------|------|
| GPIO 18 (實體 Pin 12) | 正極 (+) | 訊號輸入 (PWM 控制) |
| GND (實體 Pin 6, 9, 14, 等) | 負極 (-) | 電源負極 (接地) |

**註**：注意蜂鳴器的正負極。此專案使用 PWM 控制。

### XBOX 控制器接線
直接透過 USB 接口連接到 Raspberry Pi 的任一可用 USB Port。

### HDMI 大螢幕接線
使用 HDMI 線連接 Raspberry Pi 的 HDMI Port 到您的 HDMI 顯示器或電視。

**一般接線建議**：
- **麵包板**： 建議使用麵包板整理 GPIO 接線。
- **杜邦線**： 使用合適長度的杜邦線。
- **GPIO 圖參考**： 接線前，請務必參考您 Raspberry Pi 型號的 GPIO 引腳圖（可搜尋 "Raspberry Pi 3 GPIO pinout"）。
- **仔細檢查**： 通電前務必再次檢查所有連接，特別是 VCC 和 GND。

## 軟體安裝

### 準備系統
1. 使用 Raspberry Pi Imager 安裝最新的 Raspberry Pi OS (建議使用具有桌面環境的版本)
2. 完成系統初始設定 (語言、時區、網絡等)
3. 啟用 SPI 介面：
   ```
   sudo raspi-config
   # 選擇 Interface Options > SPI > Yes
   ```

### 安裝必要的套件
```bash
# 更新系統
sudo apt update
sudo apt upgrade -y

# 安裝 Python 套件
sudo apt install -y python3-pip python3-dev python3-pygame

# 安裝 GPIO 和 SPI 相關套件
sudo pip3 install RPi.GPIO
sudo pip3 install luma.core luma.oled

# 安裝其他依賴 (根據 requirements.txt)
sudo pip3 install evdev Pillow
```

**註**：根據 requirements.txt，Pillow 也是需要的。

### 下載遊戲程式
```bash
# 創建遊戲目錄
mkdir -p ~/gamebox
cd ~/gamebox

# 複製遊戲檔案到此目錄
# 例如：git clone <您的專案git儲存庫URL> .
# 或者手動複製所有專案檔案（包含 main.py, games資料夾, screen_menu.py 等）到 ~/gamebox
```

**提示**：建議將您的專案放在 Git 儲存庫中，方便下載和版本控制。

## 運行遊戲
```bash
cd ~/gamebox
sudo python3 main.py
```

**註**：由於需要直接控制 GPIO，可能需要 sudo 權限。

## 疑難排解

### SPI 螢幕問題
- 確保 SPI 接口已啟用
- 檢查接線是否正確
- 若螢幕無顯示，可嘗試修改 screen_menu.py 中的設備類型 (例如 ssd1306, sh1106 等)
- 執行以下命令確認 SPI 啟用狀態：
  ```bash
  lsmod | grep spi
  ```

### 控制器問題
- 執行 `lsusb` 確認控制器已連接
- 測試控制器：`sudo python3 gamepad_input.py` (如果 gamepad_input.py 在主目錄)
- 若無法識別，重新插拔控制器或嘗試不同 USB 接口
- 檢查控制器是否需要驅動 (XBOX 控制器通常 Raspberry Pi OS 自帶驅動，但若有問題可嘗試 xboxdrv)：
  ```bash
  sudo apt install xboxdrv
  ```

### 鍵盤問題
- 檢查接線
- 執行 `sudo python3 matrix_keypad.py` 測試 (如果 matrix_keypad.py 在主目錄)
- 檢查各針腳是否正確連接，可使用萬用表測試連通性

### 遊戲效能問題
- 調整 main.py 中的 FPS 設定（降低以提高效能）
- 檢查 Raspberry Pi 溫度，避免過熱降頻：
  ```bash
  vcgencmd measure_temp
  ```
- 考慮為 Raspberry Pi 增加散熱裝置

## 硬體連接參考圖

```
+---------------------+
|  Raspberry Pi 3     |
|       (BCM GPIO)    |
|                     |
|  +-------------+    |    +------------------+
|  | GPIO 6,13,19,26 |----|--> ROW 1-4        |
|  | GPIO 12,16,20,21|----|--> COL 1-4        |
|  +-------------+    |    | 矩陣鍵盤 (4x4)    |
|                     |    +------------------+
|  +-------------+    |
|  | GPIO 10(MOSI)   |----|--> DATA/MOSI      |
|  | GPIO 11(SCLK)   |----|--> CLK/SCLK       |
|  | GPIO 8 (CE0)    |----|--> CS             |
|  | GPIO 24         |----|--> DC             |
|  | GPIO 25         |----|--> RST            |
|  | 3.3V, GND       |----|--> VCC, GND       |
|  +-------------+    |    | SPI 小螢幕        |
|                     |    | (SSD1306)        |
|                     |    +------------------+
|  +-------------+    |
|  | GPIO 18         |----|--> 正極 (+)        |
|  | GND             |----|--> 負極 (-)        |
|  +-------------+    |    | 蜂鳴器            |
|                     |    | (PWM控制)         |
|                     |    +------------------+
|  +-------------+    |
|  | USB Port    |----|-----> XBOX 控制器       |
|  +-------------+    |    +------------------+
|                     |
|  +-------------+    |
|  | HDMI Port   |----|-----> 大螢幕 (顯示器)    |
|  +-------------+    |    +------------------+
+---------------------+
```

**註**：此圖為簡化示意，實際接線請以上述表格和 Raspberry Pi GPIO 引腳圖為準。

### 共通模式
所有遊戲遵循相同的基本結構，包含以下方法：
- `__init__`: 初始化遊戲和資源
- `reset_game`: 重置遊戲狀態
- `update`: 處理輸入和更新遊戲邏輯
- `render`: 渲染遊戲畫面
- `cleanup`: 釋放遊戲資源

### 音效使用
通過傳入的 buzzer 對象播放音效 (參考 buzzer.py 中的 TONE_DEFINITIONS 和方法)：
```python
# 假設 self.buzzer 是 BuzzerControl 的實例
# 得分音效
if self.buzzer:
    self.buzzer.play_tone("score")

# 遊戲結束旋律
if self.buzzer:
    self.buzzer.play_game_over_melody()

# 升級/通關音效
if self.buzzer:
    self.buzzer.play_tone("level_up") # 或 play_win_melody()
```

### 常見遊戲元素
- 碰撞檢測
- 分數系統
- 關卡/難度系統
- 暫停/繼續功能
- 動畫效果

## 許可證

本項目為開源項目，依據 MIT 許可證發佈。
(您可以在專案根目錄下添加一個 LICENSE 文件，內容為 MIT 許可證文本)

## 未來擴充

- 添加更多遊戲
- 支援多人遊戲模式
- 添加高分記錄功能 (可考慮保存到檔案)
- 支援網絡遊戲功能
- 添加配置界面，調整畫面大小和控制靈敏度
- 支援更多控制器類型
- 實現無線控制選項 (例如藍牙控制器)

